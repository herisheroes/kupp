<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Komandan Universe: Penjaga Pengetahuan</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome untuk Ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Orbitron untuk nuansa Sci-Fi & Poppins untuk teks -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        space: {
                            900: '#0B0E14',
                            800: '#151922',
                            700: '#1E2532',
                        },
                        neon: {
                            blue: '#00F0FF',
                            purple: '#BC13FE',
                            green: '#0AFF60'
                        }
                    },
                    fontFamily: {
                        display: ['Orbitron', 'sans-serif'],
                        body: ['Poppins', 'sans-serif'],
                    },
                    backgroundImage: {
                        'hero-pattern': "url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop')",
                        'loader-bg': "url('https://images.unsplash.com/photo-1465101162946-4377e57745c3?q=80&w=2078&auto=format&fit=crop')",
                    },
                    animation: {
                        'loading-bar': 'loadingProgress 2s ease-in-out infinite',
                    },
                    keyframes: {
                        loadingProgress: {
                            '0%': { width: '0%', marginLeft: '0%' },
                            '50%': { width: '100%', marginLeft: '0%' },
                            '100%': { width: '0%', marginLeft: '100%' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Animasi Bintang Latar Belakang */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: transparent;
            z-index: -1;
        }
        
        /* Efek Hover Card */
        .game-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .game-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
            border-color: #00F0FF;
        }

        /* Scrollbar Kustom */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0B0E14; 
        }
        ::-webkit-scrollbar-thumb {
            background: #1E2532; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00F0FF; 
        }

        .text-glow {
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
        }
        
        /* Helper class untuk menyembunyikan loader dengan transisi */
        .loader-hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-space-900 text-white font-body min-h-screen flex flex-col overflow-hidden">

    <!-- INITIAL LOADER SCREEN -->
    <div id="initialLoader" class="fixed inset-0 z-[100] flex flex-col items-center justify-center transition-opacity duration-700 ease-out bg-space-900">
        <!-- Background Image Loader -->
        <div class="absolute inset-0 bg-loader-bg bg-cover bg-center opacity-40"></div>
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-space-900 via-space-900/90 to-space-900/50"></div>
        
        <!-- Loader Content -->
        <div class="relative z-10 text-center px-4 max-w-lg w-full">
            <!-- Spinner -->
            <div class="w-20 h-20 border-4 border-neon-blue/20 border-t-neon-blue rounded-full animate-spin mx-auto mb-8 shadow-[0_0_30px_rgba(0,240,255,0.2)]"></div>
            
            <!-- Text -->
            <h2 class="font-display text-xl md:text-2xl font-bold text-white tracking-[0.2em] mb-2 animate-pulse text-glow">
                MENGHUBUNGKAN...
            </h2>
            <p class="text-neon-blue text-sm font-mono mb-8 tracking-widest uppercase opacity-80">
                <i class="fa-solid fa-satellite-dish mr-2 animate-pulse"></i> Mengambil Data dari Markas Pusat
            </p>
            
            <!-- Progress Bar -->
            <div class="h-1 w-full bg-space-700 rounded-full overflow-hidden relative">
                <div class="absolute top-0 left-0 h-full bg-neon-blue w-1/2 animate-loading-bar shadow-[0_0_10px_#00F0FF]"></div>
            </div>
            
            <!-- Tech Decoration -->
            <div class="mt-8 text-xs text-gray-500 font-mono flex justify-between w-full opacity-50">
                <span>SYS.VER.2.0.26</span>
                <span>SECURE CONNECTION</span>
            </div>
        </div>
    </div>

    <!-- Efek Latar Belakang -->
    <div class="stars" id="starsContainer"></div>

    <!-- NAVBAR -->
    <nav class="sticky top-0 z-50 bg-space-900/90 backdrop-blur-md border-b border-white/10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-tr from-neon-blue to-neon-purple rounded-full flex items-center justify-center shadow-lg shadow-neon-blue/20">
                    <i class="fa-solid fa-rocket text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="font-display font-bold text-xl tracking-wider text-white">KOMANDAN<span class="text-neon-blue">UNIVERSE</span></h1>
                    <p class="text-xs text-gray-400 tracking-widest uppercase">Penjaga Pengetahuan</p>
                </div>
            </div>
            
            <!-- Mobile Menu Button -->
            <button class="md:hidden text-neon-blue text-2xl" onclick="alert('Menu mobile belum aktif di demo ini.')">
                <i class="fa-solid fa-bars"></i>
            </button>

            <!-- Desktop Menu -->
            <div class="hidden md:flex gap-8 text-sm font-semibold">
                <a href="#" class="text-neon-blue hover:text-white transition-colors">DASHBOARD</a>
                <a href="#" class="text-gray-400 hover:text-neon-blue transition-colors">MISI</a>
                <a href="#" class="text-gray-400 hover:text-neon-blue transition-colors">PERINGKAT</a>
                <a href="#" class="text-gray-400 hover:text-neon-blue transition-colors">PROFIL</a>
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <header class="relative w-full h-[400px] md:h-[500px] flex items-center overflow-hidden">
        <!-- Background Image with Overlay -->
        <div class="absolute inset-0 bg-hero-pattern bg-cover bg-center"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-space-900 via-space-900/80 to-transparent"></div>
        
        <div class="container mx-auto px-4 relative z-10 text-center md:text-left">
            <div class="max-w-3xl">
                <span class="inline-block py-1 px-3 rounded-full bg-neon-purple/20 border border-neon-purple/50 text-neon-purple text-xs font-bold mb-4 tracking-widest uppercase">
                    <i class="fa-solid fa-circle-exclamation mr-1 animate-pulse"></i> Misi Baru Tersedia
                </span>
                <h2 class="font-display text-4xl md:text-6xl font-black mb-4 leading-tight">
                    JELAJAHI GALAXY <br>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-neon-blue to-neon-green text-glow">PENGETAHUAN</span>
                </h2>
                <p class="text-gray-300 text-lg mb-8 max-w-xl mx-auto md:mx-0">
                    Siapkan dirimu, Kadet! Pilih misi edukasimu, taklukkan tantangan, dan kumpulkan poin pengetahuan untuk menyelamatkan alam semesta.
                </p>
                <div class="flex flex-col md:flex-row gap-4 justify-center md:justify-start">
                    <button onclick="scrollToGames()" class="bg-neon-blue text-space-900 font-bold py-3 px-8 rounded hover:bg-white transition-all shadow-[0_0_20px_rgba(0,240,255,0.4)]">
                        <i class="fa-solid fa-gamepad mr-2"></i> MULAI MISI
                    </button>
                    <!-- Tombol LIHAT SKOR Dihapus -->
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow container mx-auto px-4 py-12 relative z-10">
        
        <!-- SEARCH & FILTER BAR -->
        <div class="bg-space-800 border border-white/10 rounded-2xl p-6 mb-12 shadow-2xl backdrop-blur-sm -mt-20 relative">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Search Input -->
                <div class="md:col-span-2 relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-search text-gray-500 group-focus-within:text-neon-blue transition-colors"></i>
                    </div>
                    <input type="text" id="searchInput" placeholder="Cari nama misi, tag, atau game..." 
                        class="w-full pl-10 pr-4 py-3 bg-space-900 border border-white/10 rounded-lg text-white focus:outline-none focus:border-neon-blue focus:ring-1 focus:ring-neon-blue transition-all placeholder-gray-500">
                </div>

                <!-- Subject Filter -->
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-book text-gray-500"></i>
                    </div>
                    <select id="subjectFilter" class="w-full pl-10 pr-4 py-3 bg-space-900 border border-white/10 rounded-lg text-white appearance-none focus:outline-none focus:border-neon-purple transition-all cursor-pointer">
                        <option value="">Semua Pelajaran</option>
                        <!-- Options will be populated by JS -->
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500">
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </div>
                </div>

                <!-- Type Filter -->
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-layer-group text-gray-500"></i>
                    </div>
                    <select id="typeFilter" class="w-full pl-10 pr-4 py-3 bg-space-900 border border-white/10 rounded-lg text-white appearance-none focus:outline-none focus:border-neon-green transition-all cursor-pointer">
                        <option value="">Semua Jenis</option>
                        <!-- Options will be populated by JS -->
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500">
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- STATISTICS BAR (Optional visual flair) -->
        <div class="flex justify-between items-end mb-8 border-b border-white/10 pb-4">
            <div>
                <h3 class="font-display text-2xl font-bold text-white mb-1">DATA MISI</h3>
                <p class="text-gray-400 text-sm">Menampilkan <span id="gameCount" class="text-neon-blue font-bold">0</span> game tersedia di database pusat.</p>
            </div>
            <div class="hidden md:flex gap-2 items-center" id="systemStatus">
                <span id="statusIndicator" class="h-2 w-2 rounded-full bg-neon-blue animate-pulse"></span>
                <span id="statusText" class="text-xs text-neon-blue uppercase tracking-widest">System Online</span>
            </div>
        </div>

        <!-- LOADING STATE (Small one for internal use) -->
        <div id="loading" class="hidden flex-col items-center justify-center py-20">
             <div class="relative w-20 h-20">
                <div class="absolute inset-0 border-4 border-white/10 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-neon-blue border-t-transparent rounded-full animate-spin"></div>
            </div>
            <p class="mt-6 text-gray-400 font-display tracking-widest animate-pulse">MEMUAT ULANG...</p>
        </div>

        <!-- ERROR STATE -->
        <div id="errorState" class="hidden flex-col items-center justify-center py-20 text-center">
            <i class="fa-solid fa-triangle-exclamation text-5xl text-red-500 mb-4"></i>
            <h3 class="text-2xl font-display font-bold mb-2">Gagal Menghubungkan</h3>
            <p class="text-gray-400 mb-6">Sinyal terputus dari markas pusat. Menggunakan data cadangan.</p>
            <button onclick="loadMockData()" class="px-6 py-2 bg-space-700 hover:bg-space-600 rounded border border-white/20 transition-colors">
                Muat Data Simulasi
            </button>
        </div>

        <!-- GAMES GRID -->
        <div id="gamesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
            <!-- Cards will be injected here via JS -->
        </div>

        <!-- EMPTY STATE (No Search Results) -->
        <div id="emptyState" class="hidden flex-col items-center justify-center py-20 text-center">
            <div class="text-6xl mb-4 opacity-50">ü™ê</div>
            <h3 class="text-xl font-bold mb-2">Tidak Ada Misi Ditemukan</h3>
            <p class="text-gray-400">Coba ubah kata kunci pencarian atau filter.</p>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-space-900 border-t border-white/10 mt-auto">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col items-center gap-6 text-center">
                <!-- Brand Info -->
                <div>
                    <h4 class="font-display font-bold text-lg text-white mb-2">KOMANDAN UNIVERSE</h4>
                    <p class="text-gray-400 text-sm tracking-wide">Game design by @herisheroes 2026</p>
                </div>
                
                <!-- Social Media Links -->
                <div class="flex items-center gap-4">
                    <!-- YouTube -->
                    <a href="https://www.youtube.com/@herisheroes" target="_blank" 
                       class="w-10 h-10 rounded-full bg-space-800 border border-white/10 flex items-center justify-center text-gray-400 hover:text-white hover:bg-[#FF0000] hover:border-[#FF0000] transition-all transform hover:scale-110 shadow-lg"
                       title="YouTube">
                        <i class="fa-brands fa-youtube text-lg"></i>
                    </a>
                    
                    <!-- TikTok -->
                    <a href="https://www.tiktok.com/@herisheroes" target="_blank" 
                       class="w-10 h-10 rounded-full bg-space-800 border border-white/10 flex items-center justify-center text-gray-400 hover:text-black hover:bg-[#00f2ea] hover:border-[#00f2ea] transition-all transform hover:scale-110 shadow-lg"
                       title="TikTok">
                        <i class="fa-brands fa-tiktok text-lg"></i>
                    </a>
                    
                    <!-- Instagram -->
                    <a href="https://www.instagram.com/herisheroes" target="_blank" 
                       class="w-10 h-10 rounded-full bg-space-800 border border-white/10 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gradient-to-tr hover:from-yellow-400 hover:via-red-500 hover:to-purple-500 hover:border-pink-500 transition-all transform hover:scale-110 shadow-lg"
                       title="Instagram">
                        <i class="fa-brands fa-instagram text-lg"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ==========================================
        // KONFIGURASI
        // ==========================================
        
        // URL API Apps Script
        const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbyLGKA52IYtzqTa8fdqy9W991iIBwI6P0gdXh8TOxxf2bVPX7jaCvc-WNd8hMchRHFW/exec"; 

        // ==========================================
        // DATA MOCKUP (Cadangan jika gagal fetch)
        // ==========================================
        const MOCK_DATA = [
            {
                id: 1,
                judul: "Aljabar Galactica",
                mata_pelajaran: "Matematika, Fisika",
                jenis: "Kuis, Strategi",
                gambar: "https://images.unsplash.com/photo-1614726365723-49cfae96a6f6?q=80&w=1000&auto=format&fit=crop",
                link_game: "#",
                deskripsi: "Hitung koordinat roket menggunakan persamaan linear sebelum waktu habis!"
            },
            {
                id: 2,
                judul: "Chronos History",
                mata_pelajaran: "Sejarah, IPS",
                jenis: "Puzzle",
                gambar: "https://images.unsplash.com/photo-1461360370896-922624d12aa1?q=80&w=1000&auto=format&fit=crop",
                link_game: "#",
                deskripsi: "Susun artefak kuno untuk membuka gerbang waktu ke masa kemerdekaan."
            },
            {
                id: 3,
                judul: "Bio-Lab Mutan",
                mata_pelajaran: "Biologi, Kimia",
                jenis: "Simulasi, Eksperimen",
                gambar: "https://images.unsplash.com/photo-1530210124550-912dc1381cb8?q=80&w=1000&auto=format&fit=crop",
                link_game: "#",
                deskripsi: "Identifikasi sel hewan dan tumbuhan untuk menciptakan vaksin alien."
            },
            {
                id: 4,
                judul: "Physics Cannon",
                mata_pelajaran: "Fisika",
                jenis: "Arcade, Simulasi",
                gambar: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?q=80&w=1000&auto=format&fit=crop",
                link_game: "#",
                deskripsi: "Tentukan sudut dan kecepatan tembak meriam plasma menggunakan hukum Newton."
            },
            {
                id: 5,
                judul: "English Voyager",
                mata_pelajaran: "Bahasa Inggris",
                jenis: "Word Game",
                gambar: "https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?q=80&w=1000&auto=format&fit=crop",
                link_game: "#",
                deskripsi: "Terjemahkan sinyal komunikasi asing untuk bernegosiasi damai."
            },
             {
                id: 6,
                judul: "Geo-Tracker",
                mata_pelajaran: "Geografi",
                jenis: "Kuis",
                gambar: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1000&auto=format&fit=crop",
                link_game: "#",
                deskripsi: "Tebak nama benua dan negara dari orbit satelit."
            }
        ];

        let allGames = [];

        // ==========================================
        // FUNGSI UTAMA
        // ==========================================

        document.addEventListener('DOMContentLoaded', () => {
            initStars();
            // Panggil fetchGames, dan setelah selesai (sukses/gagal), hilangkan loader
            fetchGames().finally(() => {
                // Beri sedikit jeda agar animasi loading terlihat minimal 1.5 detik
                setTimeout(removeLoader, 1500);
            });
            
            // Event Listeners untuk Filter
            document.getElementById('searchInput').addEventListener('input', filterGames);
            document.getElementById('subjectFilter').addEventListener('change', filterGames);
            document.getElementById('typeFilter').addEventListener('change', filterGames);
        });

        // Fungsi Menghilangkan Initial Loader
        function removeLoader() {
            const loader = document.getElementById('initialLoader');
            const body = document.body;
            
            if (loader) {
                loader.classList.add('loader-hidden');
                // Aktifkan scroll pada body
                body.classList.remove('overflow-hidden');
            }
        }

        function scrollToGames() {
            document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
        }

        // Efek Bintang Background
        function initStars() {
            const container = document.getElementById('starsContainer');
            const starCount = 50;
            
            for(let i=0; i<starCount; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 3;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.background = 'white';
                star.style.position = 'absolute';
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.opacity = Math.random();
                star.style.borderRadius = '50%';
                star.style.animation = `twinkle ${Math.random() * 3 + 2}s infinite`;
                container.appendChild(star);
            }
            
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes twinkle {
                    0% { opacity: 0.2; transform: scale(1); }
                    50% { opacity: 1; transform: scale(1.2); }
                    100% { opacity: 0.2; transform: scale(1); }
                }
            `;
            document.head.appendChild(style);
        }

        // Helper untuk memecah string "Tag1, Tag2" menjadi Array ["Tag1", "Tag2"]
        function parseTags(str) {
            if (!str) return [];
            return str.toString().split(',').map(item => item.trim());
        }

        // Ambil Data dengan Penanganan Error yang Lebih Baik
        async function fetchGames() {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('gamesGrid');
            const errorState = document.getElementById('errorState');

            // Kita sembunyikan loading internal karena sudah ada loading full screen awal
            // loading.classList.remove('hidden'); 
            grid.classList.add('hidden');
            errorState.classList.add('hidden');

            // Cek apakah URL API sudah diisi
            if (!SHEET_API_URL || SHEET_API_URL.trim() === "") {
                console.log("URL API kosong, memuat Data Mockup...");
                loadMockData();
                return;
            }

            try {
                // Menambahkan timestamp untuk menghindari caching browser yang agresif
                const targetUrl = SHEET_API_URL.includes('?') 
                    ? `${SHEET_API_URL}&t=${new Date().getTime()}`
                    : `${SHEET_API_URL}?t=${new Date().getTime()}`;

                const response = await fetch(targetUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const data = await response.json();
                loadData(data);
                
                // Reset status ke online jika berhasil
                setSystemStatus('online');

            } catch (error) {
                console.warn("Gagal mengambil data dari Sheet (CORS/Network Error). Beralih ke Data Mockup.", error);
                
                // FALLBACK OTOMATIS: Jangan tampilkan error, langsung muat data cadangan
                loadMockData();
                setSystemStatus('offline');
            }
        }

        // Fungsi untuk mengubah indikator status sistem
        function setSystemStatus(status) {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            
            if (status === 'offline') {
                indicator.classList.remove('bg-neon-blue');
                indicator.classList.add('bg-yellow-500');
                text.textContent = "OFFLINE MODE (DATA CADANGAN)";
                text.classList.remove('text-neon-blue');
                text.classList.add('text-yellow-500');
            } else {
                indicator.classList.add('bg-neon-blue');
                indicator.classList.remove('bg-yellow-500');
                text.textContent = "SYSTEM ONLINE";
                text.classList.add('text-neon-blue');
                text.classList.remove('text-yellow-500');
            }
        }

        function loadMockData() {
            loadData(MOCK_DATA);
        }

        function loadData(data) {
            allGames = data;
            populateFilters(data);
            renderGames(data);
            
            // document.getElementById('loading').classList.add('hidden'); // Tidak perlu karena loading fullscreen
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('gamesGrid').classList.remove('hidden');
        }

        // Isi Dropdown Filter secara Otomatis (Support Multiple Tags)
        function populateFilters(data) {
            const subjects = new Set();
            const types = new Set();

            data.forEach(item => {
                // Parse mata pelajaran (split by comma)
                parseTags(item.mata_pelajaran).forEach(tag => {
                    if(tag) subjects.add(tag);
                });

                // Parse jenis (split by comma)
                parseTags(item.jenis).forEach(tag => {
                    if(tag) types.add(tag);
                });
            });

            const sortedSubjects = [...subjects].sort();
            const sortedTypes = [...types].sort();

            const subjectSelect = document.getElementById('subjectFilter');
            const typeSelect = document.getElementById('typeFilter');

            // Reset options (keep the first one)
            subjectSelect.innerHTML = '<option value="">Semua Pelajaran</option>';
            typeSelect.innerHTML = '<option value="">Semua Jenis</option>';

            sortedSubjects.forEach(sub => {
                const option = document.createElement('option');
                option.value = sub;
                option.textContent = sub;
                subjectSelect.appendChild(option);
            });

            sortedTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeSelect.appendChild(option);
            });
        }

        // Render Kartu Game
        function renderGames(games) {
            const grid = document.getElementById('gamesGrid');
            const emptyState = document.getElementById('emptyState');
            const countEl = document.getElementById('gameCount');
            
            grid.innerHTML = '';
            countEl.textContent = games.length;

            if (games.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
                return;
            } else {
                grid.classList.remove('hidden');
                emptyState.classList.add('hidden');
                emptyState.classList.remove('flex');
            }

            games.forEach(game => {
                const subjectTags = parseTags(game.mata_pelajaran);
                const typeTags = parseTags(game.jenis);
                
                // Buat HTML untuk badge mata pelajaran (di atas gambar)
                // Kita hanya ambil max 2 tag agar tidak menutupi gambar
                const subjectBadges = subjectTags.slice(0, 2).map(tag => 
                    `<span class="bg-space-900/80 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-neon-blue border border-neon-blue/30">${tag}</span>`
                ).join(' ');

                // Buat HTML untuk badge jenis (di dalam body card)
                const typeBadges = typeTags.map(tag => 
                    `<span class="text-xs text-gray-400 uppercase tracking-wider flex items-center gap-1 bg-white/5 px-2 py-1 rounded">
                        <i class="fa-solid fa-tag text-[10px]"></i> ${tag}
                    </span>`
                ).join(' ');

                const card = document.createElement('div');
                card.className = `game-card bg-space-800 rounded-xl overflow-hidden border border-white/10 flex flex-col h-full`;
                
                card.innerHTML = `
                    <div class="relative h-48 overflow-hidden group">
                        <img src="${game.gambar}" alt="${game.judul}" 
                             onerror="this.src='https://placehold.co/600x400/1e2532/FFF?text=No+Image'"
                             class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        <div class="absolute top-3 left-3 flex gap-2 flex-wrap max-w-[90%]">
                            ${subjectBadges}
                        </div>
                    </div>
                    
                    <div class="p-6 flex flex-col flex-grow">
                        <div class="flex flex-wrap gap-2 mb-3">
                            ${typeBadges}
                        </div>
                        
                        <h3 class="font-display text-xl font-bold text-white mb-2 leading-tight group-hover:text-neon-blue transition-colors">
                            ${game.judul}
                        </h3>
                        
                        <p class="text-gray-400 text-sm mb-6 line-clamp-2 flex-grow">
                            ${game.deskripsi || "Tidak ada deskripsi tersedia."}
                        </p>
                        
                        <a href="${game.link_game}" target="_blank" 
                           class="w-full mt-auto bg-white/5 hover:bg-neon-blue hover:text-space-900 border border-white/10 text-white font-semibold py-3 rounded-lg transition-all text-center flex items-center justify-center gap-2 group-hover:shadow-[0_0_15px_rgba(0,240,255,0.4)]">
                            MAIN SEKARANG <i class="fa-solid fa-arrow-right -rotate-45 group-hover:rotate-0 transition-transform"></i>
                        </a>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Logika Filter (Diperbarui untuk Multi-Tag)
        function filterGames() {
            const searchVal = document.getElementById('searchInput').value.toLowerCase();
            const subjectVal = document.getElementById('subjectFilter').value; // Nilai dari dropdown
            const typeVal = document.getElementById('typeFilter').value; // Nilai dari dropdown

            const filtered = allGames.filter(game => {
                const subjectTags = parseTags(game.mata_pelajaran); // Array: ["Matematika", "Fisika"]
                const typeTags = parseTags(game.jenis); // Array: ["Kuis", "Puzzle"]

                // Cek Pencarian Text
                const matchSearch = (game.judul && game.judul.toLowerCase().includes(searchVal)) || 
                                    (game.deskripsi && game.deskripsi.toLowerCase().includes(searchVal)) ||
                                    (game.mata_pelajaran && game.mata_pelajaran.toLowerCase().includes(searchVal));

                // Cek Filter Mata Pelajaran (Apakah tag di game MENGANDUNG filter yang dipilih?)
                const matchSubject = subjectVal === "" || subjectTags.includes(subjectVal);

                // Cek Filter Jenis
                const matchType = typeVal === "" || typeTags.includes(typeVal);

                return matchSearch && matchSubject && matchType;
            });

            renderGames(filtered);
        }

    </script>
</body>
</html>